# 存储引擎

## herirchty

> [MySQL两种存储引擎: MyISAM和InnoDB 简单总结](https://www.cnblogs.com/kevingrace/p/5685355.html)

[TOC]

## 存储引擎类别

### CSV

数据存储以CSV文件方式存储

特点 :

   1. 不能定义索引, 不能设置自增列,列定义必须为NOT NULL
      -->不适用大表或者数据的在线处理
   2. CSV数据的存储用,隔开，可直接编辑CSV文件进行数据的编排
   > 注：编辑之后，要生效使用flush table XXX 命令

缺点 : 数据安全性低, 且不适用大表或者数据的在线处理

应用场景：
   数据的快速导出导入
   表格直接转换成CSV

### Archive

数据以压缩协议进行存储为ARZ文件格式

特点：
   只支持insert和select两种操作
   只允许自增ID列建立索引
   行级锁
   不支持事务
   数据占用磁盘少
应用场景：
   日志系统
   大量的设备数据采集

### Memory

   数据都是存储在内存中，IO效率要比其他引擎高很多
   服务重启数据丢失，内存数据表默认只有16M
特点：
   表级锁
   支持hash索引，B tree索引，默认hash（查找复杂度0(1)）
   字段长度都是固定长度varchar(32)=char(32)
   不支持大数据存储类型字段如 blog，text
应用场景：
   作为临时表存储需计算的数据
   查询结果内存中的计算，大多数都是采用这种存储引擎
   等值查找热度较高数据

### Myisam

1. **不支持事务**
2. **表级锁**, ACID语句都会给表自动加锁，如果加锁以后的表满足insert并发的情况下，可以在表的尾部插入新的数据。MyISAM同一个表上的读锁和写锁是互斥的，MyISAM并发读写时如果等待队列中既有读请求又有写请求，默认写请求的优先级高，即使读请求先到，所以MyISAM不适合于有大量查询和修改并存的情况，那样查询进程会长时间阻塞。因为MyISAM是锁表，所以某项读操作比较耗时会使其他写进程饿死。
3. 强调的是性能，每次查询具有原子性, 查询速度快
4. 可被压缩，存储空间较小。支持三种不同的存储格式：静态表(默认，但是注意数据末尾不能有空格，会被去掉)、动态表、压缩表。
5. 数据是以文件的形式存储，所以在跨平台的数据转移中会很方便。在备份和恢复时可单独针对某个表进行操作。
6. 可以和其他字段一起建立联合索引。引擎的自动增长列必须是索引，如果是组合索引，自动增长可以不是第一列，他可以根据前面几列进行排序后递增。
7. 数据（MYD）和索引（MYI）分开存储, 天生非聚簇索引，最多有一个unique的性质
8. 支持(FULLTEXT类型的)全文索引
9. 允许没有任何索引和主键的表存在，索引都是保存行的地址。表中保存着具体的行数, 如果select count(\*) from table;会直接取出出该值。
10. 不支持外键

> MyISAM管理非事务表。它提供高速存储和检索，以及全文搜索能力。如果应用中需要执行大量的SELECT查询，那么MyISAM是更好的选择。

### Innodb

1. **支持了ACID兼容的事务**
2. **行级锁**, 行锁大幅度提高了多用户并发操作的新能。但是InnoDB的行锁，只是在WHERE的主键是有效的，非主键的WHERE都会锁全表的。
3. InnoDB的AUTOCOMMIT默认是打开的，即每条SQL语句会默认被封装成一个事务，自动提交，这样会影响速度，所以最好是把多条SQL语句显示放在begin和commit之间，组成一个事务去提交。
4. 需要更多的内存和存储，它会在主内存中建立其专用的缓冲池用于高速缓冲数据和索引。
5. 免费的方案可以是拷贝数据文件、备份 binlog，或者用 mysqldump，在数据量达到几十G的时候就相对痛苦了。
6. InnoDB中必须包含只有该字段的索引。引擎的自动增长列必须是索引，如果是组合索引也必须是组合索引的第一列。
7. 所有的表都保存在同一个数据文件中（也可能是多个文件，或者是独立的表空间文件），数据文件本身就是主键索引文件，这样的索引被称为"聚簇索引"
8. 不支持(FULLTEXT类型的)全文索引，但是innodb可以使用sphinx插件支持全文索引，并且效果更好。
9. 如果没有设定主键或者非空唯一索引，就会自动生成一个6字节的主键(用户不可见)，数据是主索引的一部分，附加索引保存的是主索引的值。InnoDB的主键范围更大，最大是MyISAM的2倍。
10. 支持外键

> InnoDB用于事务处理应用程序，具有众多特性，包括ACID事务支持。如果应用中需要执行大量的INSERT或UPDATE操作，则应该使用InnoDB，这样可以提高多用户并发操作的性能。

## 选择数据表分析因素

1. 数据库是否有外键？
2. 是否需要事务支持？
3. 是否需要全文索引？
4. 数据库经常使用什么样的查询模式？在写多读少的应用中还是Innodb插入性能更稳定，在并发情况下也能基本，如果是对读取速度要求比较快的应用还是选MyISAM。
5. 数据库的数据有多大？ 大尺寸倾向于innodb，因为事务日志，故障恢复。