# 数据库设计规范

## 三大范式

1. 第一范式：
   每一列字段具有原子性, 不可拆分, 两列的属性相近或相似或一样，尽量合并属性一样的列，确保不产生冗余数据。
   简单来说就是 : 某列字段不能拥有几个值

2. 第二范式(需先满足第一范式)：
   R得所有非主属性都完全依赖于R的每一个候选关键属性.

3. 第三范式(需先满足第二范式)：
   数据不能存在传递关系，即每个属性都跟主键有直接关系而不是间接关系。

   > 比如Student表（学号，姓名，年龄，性别，所在院校，院校地址，院校电话）
   > 可以转换为
   >（学号，姓名，年龄，性别，所在院校）--（所在院校，院校地址，院校电话）

三大范式只是一般设计数据库的基本理念，可以建立冗余较小、结构合理的数据库。如果有特殊情况，当然要特殊对待，数据库设计最重要的是看需求跟性能，需求>性能>表结构。所以不能一味的去追求范式建立数据库。

> 1nd 会产生过多字段
> 3nd 会导致较多表关联, 影响性能
> 外键会导致额外开销

## 其它规范

### 表命名规范

1. 数据库表名尽量使用`英文简单`全程, 使用`大写下划线`形式.

   > eg: 机构表 `INSTRUCTION`

2. 每个数据库表名尽量有一个简称, 且简称尽量为一个连续的字符串, 不包含下划线

   > eg: 机构表 `INSTRUCTION` 的缩写为 `INST`

3. 一张表连接两张表, 前缀要加 `link_`.

   > eg: 用户表(user), 角色表(role), 它们之间的关联表为 `link_user_role`

4. 如果是通过表字段映射, 前缀要加 `map_`.

   > eg: A中数据映射B的内容, 则使用 `MAP_A_B`

5. 一种类型的表前面尽量加前缀.

   > eg: 组织架构表(用户表, 角色表), 前面加 `acc`

### 表命名规范2

注意后面两个下划线

1. `s__` 开头表: 一般作为数据源表, 例如在数据映射过程中作为数据源比对传入到数据库中的源表

2. `r__` 开头表(冗余表): 真正运行过程中不会使用到的临时表, 但是又因为某些原因, 如果直接删除又会造成后续工作量增加的表

3. `t__` 开头表(临时表): 可以直接删除掉的表(一般上线需要删除)

### 字段类型命名规范

1. 为了在使用过程中就能够判断出这些字段

凡是没有下面开头的字段, 尽量是非空字段.

1. c_ 开头字段: 一般不是必要的源数据字段, 但是由于为了加快程序运行速度, 实现计算好存到该字段中的字段, 例如用户表中有一个字段, 是当前用户共发送了多少条消息, 这个字段中的值只用于显示, 但是在联查或查找的时候禁止使用该字段.

   1. 非真正意义上的源数据, 删除可能会影响到程序运行, 但是这些数据可以通过真源数据计算或联查得到.
   2. 除非业务需要, 除非性能需要, 否则尽可能避免联查或核心业务使用到该字段.

2. r_开头字段: 冗余字段, 和 c_开头字段的区别是, c_开头的字段是可以通过其它源数据计算或关联得出来的, 但是, 这个字段无法通过计算或关联得出, 非必要字段. 但是如果直接删除会增加后续维护工作量.

   1. 真正意义上的源数据, 但是又不是需要的数据, 删除不会影响到程序正常运行, 但可能会影响到界面的展示.
   2. 除非业务需要, 除非性能需要, 否则尽可能避免联查或核心业务使用到该字段.
   eg: 在数据库设计的时候, 有些数据表明显不会在程序运行过程中使用到`描述`字段, 但是在配置数据的时候, 为有些数据添加描述能够更好的让人明白这些数据的意思, 可以将这些字段作为冗余字段.

3. t_: 临时字段: 即便直接删掉也不会影响到程序运行的字段. **上线时必须删除**的字段.

### 字段名规范

1. 所有表主键名尽量使用 `GUID`, 在当前表中的其它表关联字段尽量使用 `其它表简称_` + `其它表字段名简写` 的形式.

   > eg: 在用户表`USER`里面有一个机构标识字段, 则机构标识字段应为 `机构表简写 + 标识简写`: `INST_GUID`.

2. 数据表里面尽量去除冗余字段, 因查询效率无法去除的冗余数据采用字段前面加 `so`(select only)的形式, 且这个字段仅能够作为查询使用, 禁止作为关联标识, 或值设置.

   > eg: 在用户表里面有一个机构名称的字段, 则这个字段名将应该设为 `SO_INST_NAME`, 且这个字段仅能够作为查询使用, 禁止作为关联标识, 或值设置.
