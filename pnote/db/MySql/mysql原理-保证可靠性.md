# mysql 日志作用

> <https://www.cnblogs.com/wq-blogs/p/11867199.html>, <mysql是怎样运行的>

mysql 故障重启后

   1. 根据 redolog 进行重做, 防止发生故障之后, 有脏页没有刷盘.
   2. 但是 redolog 还会恢复一些没有提交的事务的数据, 因此再通过 undolog进行一次回滚.



1. undolog

   作用：保存了事务发生之前的数据的一个版本，可以用于回滚，同时可以提供多版本并发控制下的读（MVCC），也即非锁定读
   内容: 逻辑格式的日志，在执行undo的时候，仅仅是将数据从逻辑上恢复至事务之前的状态，而不是从物理页面上操作实现的，这一点是不同于redo log的。

2. redolog

   确保事务的持久性。防止在发生故障的时间点，尚有脏页未写入磁盘，在重启mysql服务的时候，根据redo log进行重做，从而达到事务的持久性这一特性。
   物理格式的日志，记录的是物理数据页面的修改的信息，其redo log是顺序写入redo log file的物理文件中去的。

3. bin log

   归档日志（二进制日志）
   作用：用于复制，在主从复制中，从库利用主库上的binlog进行重播，实现主从同步。用于数据库的基于时间点的还原。

   逻辑格式的日志，可以简单认为就是执行过的事务中的sql语句。但又不完全是sql语句这么简单，而是包括了执行的sql语句（增删改）反向的信息，也就意味着delete对应着delete本身和其反向的insert；update对应着update执行前后的版本的信息；insert对应着delete和insert本身的信息。

　　binlog 有三种模式：Statement（基于 SQL 语句的复制）、Row（基于行的复制） 以及 Mixed（混合模式）

## 详细

1. mysql 每次写入操作, io操作, 查询成本很高

   解决方案: WAL技术（Write-Ahead Logging）。先顺序写日志，再写磁盘。

   当有一条记录需要更新的时候，InnoDB 引擎就会先把记录写到 `redo log` 里面，并更新内存，这个时候更新就算完成了。
   
   InnoDB 引擎会在适当的时候，将这个操作记录更新到磁盘里面，而这个更新往往是在系统比较空闲的时候做。

2. bin log

   MySQL 整体来看，其实就有两块：一块是 Server 层，它主要做的是 MySQL 功能层面的事情；还有一块是引擎层，负责存储相关的具体事宜。redo log 是 InnoDB 引擎特有的日志，而 Server 层也有自己的日志，称为 binlog（归档日志）。

   

