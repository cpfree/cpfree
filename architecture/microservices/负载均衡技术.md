# 负载均衡技术

> 参考自 <http://www.ideadata.com.cn/wisdomAction/readWisdom.do?id=75>

负载均衡（Load Balance）并不属于网络基础架构，而是属于一种网络优化设备或方式。它是建立在现有的网络基础架构之上，给企业提供了更廉价更有效的扩展选择。

## 负载均衡技术分类

1. 软件负载均衡技术
   > 在一个或多个交互的网络系统中的多台服务器上安装一个或多个相应的负载均衡软件来实现的一种均衡负载技术。
   > **优点**: 安装配置简单、操作也方便，扩展性好, 最重要的是成本很低
   > 目前比较流行的是`LVS`和`Nginx`
2. 硬件负载均衡技术
   > 在多台服务器间安装相应的负载均衡设备，也就是负载均衡器来完成均衡负载技术.
   > **优点**: 与软件负载均衡技术相比，能达到更好的负载均衡效果, 且设备更稳定(与系统和应用的状态无关，而只是从网络层来判断)
   > 需要额外的增加负载均衡器，成本比较高，所以适用于流量高的大型网站系统。
   > 比较流行的是 `F5`
3. 本地负载均衡技术
   > 本地负载均衡技术是对本地服务器群进行负载均衡处理。该技术通过对服务器进行性能优化，使流量能够平均分配在服务器群中的各个服务器上.
4. 全局负载均衡技术（也称为广域网负载均衡）
   > 全局负载均衡技术适用于拥有多个地域的服务器集群的大型网站系统。
   > 全局负载均衡技术是对分布在全国各个地区的多个服务器进行负载均衡处理，该技术可以通过对访问用户的IP地理位置判定，自动转向地域最近点。很多大型网站都使用的这种技术。
5. 链路集合负载均衡技术
   > 链路集合负载均衡技术是将网络系统中的多条物理链路，当作单一的聚合逻辑链路来使用，使网站系统中的数据流量由聚合逻辑链路中所有的物理链路共同承担。这种技术可以在不改变现有的线路结构，不增加现有带宽的基础上大大提高网络数据吞吐量，节约成本。

### F5 BIG-IP负载均衡器（LTM）

F5 BIG-IP LTM的官方名称叫做本地流量管理器，可以做4-7层负载均衡，具有负载均衡、应用交换、会话交换、状态监控、智能网络地址转换、通用持续性、响应错误处 理、IPv6网关、高级路由、智能端口镜像、SSL加速、智能HTTP压缩、TCP优化、第7层速率整形、内容缓冲、内容转换、连接加速、高速缓存、 Cookie加密、选择性内容加密、应用攻击过滤、拒绝服务(DoS)攻击和SYN Flood保护、防火墙-包过滤、包消毒等功能。

F5优点

   1. 基于简单的Web管理界面.
   2. 还可以处理SSL证书
   3. 广域网优化管理器，具备高可用的加密通道，同时具有广域网传输速度，优化与数据中心的传输道路。几乎是自动地就产生了一个简单的基于广域网的灾难恢复解决方案。
   4. **能够直接通过智能交换机实现, 相比于软负载, F5负载性能更强**.
   5. **与系统无关, 适用于一大堆设备、大访问量、简单应用**，

F5 劣势

   成本高,无法有效掌握服务器及应用状态

### LVS(Linux Virtual Server)

1. 基于Linux, 开源免费
2. **工作在4层**, 基本上能支持所有应用做负载均衡(http、数据库、聊天室...), 

缺点

   LVS要求技术水平很高，操作上也比较复杂，配置也很繁琐，没有赖以保障的服务支持，
   对网络要求高, 稳定性来说也相对较低（人为和网络环境因素更多一些）。

### Nginx 负载

1. Nginx是工作在第七层，对于网络的依赖性相对于`LVS`就小的多, 因此测试方面也更简单
2. 安装和配置也相对简单一些.

缺点:
   应用要比LVS少

## Nginx和F5同时使用案例

负载均衡器F5作为处理外界请求的第一道“墙”，将请求分发到web服务器后，web服务器上的Nginx再进行处理，静态内容直接访问本地门户，动态数据则通过反向代理指向内网服务。

![Nginx和F5同时使用案例](https://gitee.com/cpfree/picture-warehouse/raw/master/pic/20210629171542.png)

目前很多网站或应用在设计之初都会为高并发的数据请求做负载均衡，不差钱的土豪用户一般会直接买F5硬件设备作为其负载均衡器，原因不用多说，其功能强大，

如果不差钱，完全可以直接上F5，同时配以Nginx作为负载均衡及web容器，处理大数据量的用户并发完全没问题.
如果预算不够，其实Nginx目前也能满足大多数用户需求了，

> 当然也不能迷信负载均衡，程序、SQL等涉及数据处理的业务逻辑的地方，无论是架构还是代码亦或是模型的合理性，其重要性永远是要高于中间件的。

### 域名解析，一个域名可以对应多个IP地址（基于DNS的负载均衡）

   <https://blog.csdn.net/krismile__qh/article/details/99867042>
