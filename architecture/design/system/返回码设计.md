# 返回码(状态码)设计

做一个系统, 返回码是很重要的, 良好的返回码设计能够降低沟通成本, 维护成本, 以及能够快速定位错误

> 之前在系统里面设计过一套返回码, 当时返回码是4位数字型字符串, 0开头的代表成功, 1-9开头的代表失败, 但是后来觉得`0`开头的设计有点问题, 后来都使用`1`开头表示成功.

1. 返回码一般是公开的, 开发人员, 业务人员甚至用户都可以看, 只有返回码不行, 最好返回码和信息一起使用, 信息是给开发人员看的, 返回码时候公开的, 可以设计成一个返回码对应一个信息, 也可以设计成一个返回码对应多条信息. 甚至是加上日志的帮助, 帮助程序员快速定位错误.
2. 给用户看的信息和给开发人员看的信息可能不相同, 我看可以在最外层使用message进行转译, 或者是在定义的时候将给所有人员看的信息进行统一配置.
3. 返回码的作用同时还是为了让程序能够区分出来错误类型.
4. 根据Code的返回饼图，帮助我们发现系统、业务流程中的问题.
5. 好的返回码设计，可以帮助我们提高沟通效率，降低代码的维护成本

## 返回码设计思想

1. 状态码一定要考虑的特别全面, 细致, 一旦一套状态码模型和方案设计完成, 之后就尽量不要改动它(除非是内部的小型团队开发, 而且状态码并没有向外暴漏出去, 并没有被别的项目使用或依赖等等...).
2. 简单, 清晰, 互斥, 分离, 根据不同类型的错误分离不同类型的状态码, 状态码的设计一定要清晰, 状态码相互间一定要有清晰的互斥关系, 绝不能朦胧的混乱, 实在是比较朦胧且场景很多的, 可以根据项目情况考虑用一个状态码来表示.
3. 有的状态码需要分的很细致(细致的状态码能够非常好的定位错误), 有的状态码不要分的太细致(太细致的状态码会导致程序员在开发的时候很混乱, 而且管理变得麻烦, 而且对查找问题实际上可能并没有那么大帮助).
4. 适当根据系统情况设计, 如果能4位数字代表的就不要使用5位数字, 4位数字就可以代表10000种不同情况, 哪怕是大型项目实际上都足够了, 不要想着5位数字能够代表更多的情况, 实际上太多的情况程序员在开发的时候也记不过来, 反而会造成返回状态码混乱, 增加排查难度(甚至有时候有些程序员特别怕麻烦, 随意的返回不匹配的状态码, 导致排查困难).
5. 一定要考虑团队实际情况, 你认真设计了一整套状态码, 你也觉得是一个很好的设计, 但是可能和你配合的程序员觉得学习成本很高, 就是嫌麻烦, 就是不认真使用, 那再好的状态码设计都没用.
6. 状态码可以帮助程序员找出bug, 降低沟通成本和维护成本, 但是状态码也是给运维, 给项目经理, 给用户看的, 给api使用者看的, 开发者在排查问题的时候还是主要看日志, 看消息信息, 可以将状态码和消息联合起来使用, 外部人员看状态码, 开发人员看日志和状态码.
7. 如果市场或公司有一套标准的状态码的话, 可以考虑优先使用标准的状态码, 使用众人验证过的, 约定过的验证码系统有诸多般好处.
8. 确确实实的保证你的设计确实是优化了系统, 并且团队成员也确确实实的遵守了开发规范, 最终开发成本, 设计成本, 时间成本, 优雅性, 可扩展性总体来说确确实实提高了, 那这个设计才是值得的.
9. `当局者迷, 旁观者清`, 设计完成之后最好是整个团队review一下, 请公司的架构师和高级程序员, 甚至是项目经理和测试运维发表一下见解, 也许就能找出你设计的一些bug, 消除一些隐患, 或者是升级一下你的设计思想, 也许你觉得自己设计的确实很屌很屌, 但很可能只是你的一个幻觉. 请整个团队review一下, 也能让整个团队或者是领导放心. 如果你设计的通过了, 那么设计也大多是是你的功劳, 如果正式使用过程中确实出现了什么问题, 你也可以往外推责任:(那啥, 明明让你们review了, 你们都一个个干啥吃的. 当然这都是后话, 实际可能没那么理想)

## 状态码设计可以参考HTTP的返回码设计

分段分层设计(6位)

分段类型

   10: 服务器收到请求, 
   20: 成功
   30: 分段操作
   40: 请求参数异常
   50: 服务内部错误
   60: 会话超时

操作涉及

   查询
   新增
   修改
   

业务类型: 2位(90种业务)

   10: 账号相关

具体结果类型(2位)(100种情况)

   10: 操作成功
   11: 验证码失败

