---
keys: 
type: copy,blog,trim
url: <>
id: 220124-124929
---

# 与Citrix的抗争笔记

## 背景

进了一家机构, 进出刷卡, 且必须通过其**内网环境**连接**Citrix**进行各种工作.

## 关于Citrix的使用痛点

关于远程虚拟桌面, 有以下几个痛点

1. 环境问题

   网络不好, 卡的要死不说, 很多本地的软件都没法直接使用(本地明明装了大量的软件和工具, 总不能在citrix上面再全部装一遍吧).

2. 双屏问题

   日常开发我都是使用双屏的, 可使用citrix后就没有办法用双屏了, 写个代码还好, 关键写文档, 调试代码的时候真是痛苦.

3. 上传数据

   文件是可以上传到Citrix上面的, 但是麻烦的一批, 需要用另外的专用电脑, 让别人帮你传上去.

   要替换个图片, 想将自己之前的代码上传上去都特别麻烦, 有时候上传个代码文件, 真是懒得去走上传流程, 宁愿自己一个字符一个字符手动敲上去.

4. 下载数据

   写个文档, 恶心的一批, 文档需要基于模板文件来写, 模板文件在`Citrix`上, 没法直接下载, 想要画个图片, 虚拟桌面没法连外网, 没法用ProcessOn, 也没有visio, 只能在本机画好图片后再想办法传到虚拟桌面.

综上, 实在受不了了, 我需要想个办法把文件从Citrix种拿出来.

## 构思1:使用图片传递信息,把文件从虚拟桌面拿出来

虽然没有办法把文件从远程虚拟桌面拿出来, 但是啊, 既然可以看到远程桌面, 那么还不能传递信息吗?

本机截屏功能没有被禁止掉, 从本地电脑截取远程桌面展示的屏幕so easy啊.

> 即便禁掉截屏也不怕, 之前就遇到过这种情况, 例如一些播放器会在工作时会禁掉本地截屏功能, 这种情况下, 虚拟机和容器化技术能够帮助你, 例如把这些程序放到沙箱软件里面运行.

将信息截屏之后再识别出来, 不就可以获取远程虚拟桌面的信息了吗?

例如将一段文本信息变成二维码, 然后识别二维码不就可以获取信息了吗?

当然, 二维码里面存储的信息量太少, 信息密度又太低, 无法携带大量的信息.

那么就要一个办法去创作一个可以携带大量信息的超级二位信息截屏图片了.

**那么一张图片能够携带多少信息呢?**

我们先来算一下上限, 一张高清屏有2,073,600(1920*1080)个像素(这里没有算长截图的情况), 每个像素有16,777,216(256*256*256, 这里只算了红蓝绿,没有算透明度)种颜色, 也就是说每个像素最高能表示3byte(24bit)的数据, 一个屏幕可以存放6075byte(1920*1080*3/1024)的数据, 也就是5.93M数据.

可见一张截屏携带的数据量是足以满足传输文件的要求的, 此时方案已经出来了.

将文件转换成图片, 之后截取屏幕, 再在本地识别出来, 遇到大文件, 就使用长截屏, 再大的文件, 就将大文件压缩成无数个分卷的小文件之后截屏(操作系统里面都是自带压缩功能的,就看你会不会用了,再不济就上传个压缩软件上去).

## 技术实现1

既然构思有了, 于是就有了 `bit-data-map` 的诞生, 由于 `bit-data-map` 内容不少, 就不放到这里说, 详情请看我关于 `bit-data-map` 的文档介绍.

## 构思2:使用

程序写好了, 那么应该如何传进去呢?

代码大概只有30KB左右, 但是如果走上传审核流程的话, 文件可能会被备份存档, 那么手动敲进去就可以了吧, 然后有感觉很麻烦, 于是这个时候我又想到了按键精灵这个软件, 利用按键精灵将写好的代码一个个输入进去就省得手动去敲击了.

然而, 下载下来之后就出现了问题, 使用按键精灵一个个敲到远程桌面脚本没那么容易写, 每个字符敲击都是需要有时间间隔的, 如果敲击太快, 虚拟桌面是不会识别的, 再加上按键精灵安装没有多久就弹出个广告窗口来, 使我一怒之下直接把它卸载了(我的电脑绝不安装弹广告的垃圾软件).

之后搜了其它按键精灵类似的软件, 有免费且无广告的, 但是都有一个问题就是没有办法传入中文, 因为远程虚拟桌面只能识别你键盘上敲击的字符, 中文什么的需要根据远程虚拟桌面的输入法来定, 虽然我可以先把注释给去掉, 只输入英文字符, 但是写脚本也很麻烦.

于是最终决定, 自己写个输入工具来!

之后写了个简单的窗口, 使用java写的, 功能是读取文本文件或JTextArea里面的内容, 之后模拟键盘敲击, 将字符一个个输入出来.

   1. 好处是自己能够根据自己的需求对功能进行调整和扩展.
   2. 能够往远程虚拟桌面输入中文.

写完之后于是我就使用这个程序把bit-data-map代码传了进去.

## TODO 结合window bat&sendTo, 使内部生成图片变得更加方便

## TODO 生成图片解析过程中的相关问题

## TODO 通过键盘敲击实现将小文件传入虚拟桌面

## TODO 一键将文件展示为图片, 不产生任何图片文件

## TODO 实现虚拟桌面里面的粘贴板获取功能

## TODO 大规模文件打包一次性传输

## Endpoint-IO-transfer.jar


