# Top

> 最近想要将数据同步到云盘上, 阿里云盘又迟迟不推出文件同步功能, 所以搬出来了很久没有用过的 OneDrive, 同步自己的文件夹.
> 但是OneDrive 有一个问题, 那就是OneDrive不支持多个不同位置的文件夹的同步, 但是没关系, 可以使用软连接搞定.
> 在window里面手动创建软连接一般需要使用命令行, 一行代码就可以创建一条软连接, 但是有时候真的是连那一行代码都懒得敲, 因为直接通过右键或拖拽的方式创建软连接是那么的方便.
> 事实上右键实现创建软连接在几年前就实现过, 当时是在网上找的各种脚本, 当时还找了两种方式, 一种是vbs脚本一种是bat脚本, 然后再通过修改注册表将脚本注册到右键, 然后就可以右键文件创建软连接了.
> 然而事与愿违, 当时的代码找不到了, 而且当时的代码很是繁琐(代码自动获取管理员权限, 修改注册表等等特别麻烦), 记得当时为了实现这个小功能花了两天时间, 于是就凭着自己现有的经验用一种新的方案实现这个简单的小功能.

## step1: 编写一行bat脚本代码

1. 找一个文件夹创建一个bat文件.
   > 例如我是在 `C:\Users\CPF\my_ev` 目录下创建了一个 `symbol-link.bat` 的文件.
2. 往文件里面输入创建软连接的代码.

   ```bat
   @echo off
   dir /ad/b "%1" 2>nul && mklink /D %~dpn1-sln%~x1 %1 || mklink %~dpn1-sln%~x1 %1
   ```

   > 这句代码中的`%1`代表你传入的文件路径, 整体的意思就是为`%1`创建一个软连接, 并放在`%1`所在的目录下, 并在后面加上`-sln`(由于同一个目录下不能放两个同名文件, 不加的话放不成功. 当然你也可以房子其它文件夹下, 并配上相同的名字)
   >
   > 这句代码可以拆分成三句.
   > `dir /ad/b "%1" 2>nul && {语句1} || {语句2}` : 如果 `%1` 是文件夹, 则执行`{语句1}`, 否则执行`{语句2}`.
   > `mklink /D %~dpn1-sln%~x1` : 为文件夹创建一个符号连接, 放在同目录下, 后面加上 `-sln`.
   > `mklink %~dpn1-sln%~x1` : 为文件创建一个符号连接, 放在同目录下, 后面加上 `-sln`.

   明白了原理之后, 你还可以改成这样

   ```bat
   for %%a in ( "%1" ) do set "b=%%~aa"
   if defined b (
   if %b:~0,1%==d ( mklink /D %~dpn1-sln%~x1 %1 ) else (  mklink %~dpn1-sln%~x1 %1 ) 
   )
   ```

   ```bat
   cd "%1" 2>nul
   if %ERRORLEVEL% ==1 (set a=1) else (set a=0)
   echo %a%
   ```

## step2: 为你的bat文件添加以管理员权限运行的功能

> 这一步本是最复杂的, 几年前我就为了这个搞了好久好久才搞出来(当时是通过bat脚本实现的).

现在我们采用一种新的方式, 
   
1. 为你的文件创建快捷方式.
2. 之后右键快捷方式, 为快捷方式上面添加管理员身份运行的配置

## step3: 添加到右键菜单

> 这一步几年前我是通过修改注册表搞定的, 但后来发现一种非常简单的方式

1. 打开你的 `SendTo` 文件夹

   > `SendTo` 文件夹一般在 `C:\Users\{你的用户名}\AppData\Roaming\Microsoft\Windows\SendTo`

   > 或者使用 `Win+R` 键, 输入 `shell:sendto`, 之后回车, 就可以打开你的 `sendTo` 文件夹了.

2. 将 `step2` 中创建的快捷方式移动到这个文件夹.

   然后你右键文件, 鼠标移动到发送至菜单选项上, 后面便会出现你刚才移动的快捷方式了.
